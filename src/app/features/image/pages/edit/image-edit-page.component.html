<div class="page has-breadcrumb">
  <form [formGroup]="imageEditService.form">
    <formly-form
      [fields]="imageEditService.fields"
      [form]="imageEditService.form"
      [model]="imageEditService.model"
    ></formly-form>
  </form>
</div>

<ng-template #remoteSourceLabelTemplate let-item="item">
  <span class="code">{{ item.label }}</span>
  <span *ngIf="imageEditService.isSponsor(item.value)" class="remote-affiliate-sponsor">(sponsor)</span>
</ng-template>

<ng-template #remoteSourceOptionTemplate let-item="item">
  <span class="code">{{ item.label }}</span>
  <span *ngIf="imageEditService.isSponsor(item.value)" class="remote-affiliate-sponsor">(sponsor)</span>
</ng-template>

<ng-template #equipmentStepButtonsTemplate>
  <button
    [class.loading]="loadingService.isLoading()"
    id="clear-equipment-btn"
    class="btn btn-outline-danger mr-2"
    (click)="onClearEquipmentClicked()"
  >
    {{ "Clear" | translate }}
  </button>

  <div class="btn-group" role="group">
    <div ngbDropdown placement="top-right">
      <button
        [class.loading]="loadingService.isLoading()"
        id="load-preset-dropdown"
        class="btn btn-outline-secondary"
        ngbDropdownToggle
      >
        {{ "Load preset" | translate }}
      </button>
      <div aria-labelledby="load-preset-dropdown" ngbDropdownMenu>
        <ng-container *ngIf="presets$ | async as presets">
          <li *ngIf="presets.length === 0; else hasPresets" class="btn btn-disabled">
            {{ "You don't have any saved presets." | translate}}
          </li>
          <ng-template #hasPresets>
            <li *ngFor="let preset of presets">
              <button class="dropdown-item" (click)="onApplyEquipmentPresetClicked(preset)">
                {{ preset.name }}
              </button>
            </li>
          </ng-template>
        </ng-container>
      </div>
    </div>

    <button
      [class.loading]="loadingService.isLoading()"
      id="save-preset-btn"
      class="btn btn-outline-secondary"
    >
      {{ "Save preset" | translate }}&hellip;
    </button>
  </div>
</ng-template>

<ng-template #stepperButtonsTemplate let-isLastStep="isLastStep">
  <div ngbDropdown placement="top-right">
    <button
      *ngIf="isLastStep"
      [class.loading]="loadingService.isLoading()"
      class="btn btn-primary"
      id="save-dropdown"
      ngbDropdownToggle
    >
      {{ "Save" | translate }}&hellip;
    </button>
    <div aria-labelledby="save-dropdown" ngbDropdownMenu>
      <h6 class="dropdown-header">{{ "Where do you want to go after saving?" | translate }}</h6>

      <button
        (click)="
          onSave(
            $event,
            classicRoutesService.EDIT_IMAGE_GEAR(imageEditService.image.hash || '' + imageEditService.image.pk) +
              '?upload'
          )
        "
        class="dropdown-item"
      >
        {{ "Save and proceed to gear selection" | translate }}
      </button>

      <button
        (click)="
          onSave(
            $event,
            classicRoutesService.EDIT_IMAGE_ACQUISITION(imageEditService.image.hash || '' + imageEditService.image.pk) +
              '?upload'
          )
        "
        class="dropdown-item"
      >
        {{ "Save and proceed to acquisition details" | translate }}
      </button>

      <button
        (click)="
          onSave($event, classicRoutesService.IMAGE(imageEditService.image.hash || '' + imageEditService.image.pk))
        "
        class="dropdown-item"
      >
        {{ "Save and proceed to image" | translate }}
      </button>
    </div>
  </div>
</ng-template>
