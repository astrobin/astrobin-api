<h1 class="page d-flex justify-content-between">
  <span class="flex-grow-1">
    {{ "Submission queue" | translate }}
  </span>

  <astrobin-refresh-button (click)="refresh()"></astrobin-refresh-button>
</h1>

<ng-container *ngIf="submissionQueue$ | async as submissionQueue">
  <ng-container *ngIf="submissions$ | async as submissions">
    <ng-container *ngIf="submissionQueue?.count > 0; else noEntries">

      <div *ngIf="promotionSlots$ | async as promotionSlots" class="promotion-slots page">
        <div *ngFor="let slot of promotionSlots; let i = index" class="promotion-slot">
          <ng-container *ngIf="submissions.length > i; else emptySlot">
            <astrobin-image
              (click)="scrollToEntry(submissions[i].image)"
              [alias]="ImageAlias.STORY"
              [id]="submissions[i].image">
            </astrobin-image>
          </ng-container>

          <ng-template #emptySlot>
            {{ i + 1 }}
          </ng-template>
        </div>
      </div>

      <ngb-pagination *ngIf="paginationService.showPagination(submissionQueue.count)" (pageChange)="pageChange($event)"
                      [(page)]="page" [collectionSize]="submissionQueue.count">
      </ngb-pagination>

      <div *ngFor="let entry of submissionQueue.results"
           #submissionQueueEntries
           id="submission-queue-entry-{{entry.pk}}"
           class="row no-gutters page submission-queue-entry"
           [class.promoted]="(isSubmitted$(entry.pk) | async) === true">
        <astrobin-fullscreen-image-viewer [id]="entry.pk"></astrobin-fullscreen-image-viewer>

        <div class="col-sm-12 col-md-6 col-image">
          <astrobin-image
            class="submission-image mb-2 mb-md-0 pr-0 pr-md-1"
            [alias]="ImageAlias.STORY"
            [id]="entry.pk"
            (click)="viewFullscreen(entry.pk)">
          </astrobin-image>
        </div>

        <div class="col-sm-12 col-md-6 col-image">
          <astrobin-image
            class="pl-0 pl-md-1"
            [alias]="ImageAlias.REGULAR_CROP_ANONYMIZED"
            [id]="entry.pk">
          </astrobin-image>
          <div class="hundred_percent">100%</div>
        </div>

        <div class="col-12">
          <div class="row align-items-end mt-3">
            <div class="col-12 col-md-6 col-gear">
              <p>
                <strong>{{ "Imaging telescopes" | translate }}:</strong>
                <ng-container *ngIf="entry.imagingTelescopes?.length > 0; else noneSpecified">
                  <astrobin-telescope
                    *ngFor="let telescope of entry.imagingTelescopes"
                    [id]="telescope">
                  </astrobin-telescope>
                </ng-container>
              </p>

              <p>
                <strong>{{ "Imaging cameras" | translate }}:</strong>
                <ng-container *ngIf="entry.imagingCameras?.length > 0; else noneSpecified">
                  <astrobin-camera
                    *ngFor="let camera of entry.imagingCameras"
                    [id]="camera">
                  </astrobin-camera>
                </ng-container>
              </p>

              <p>
                <strong>{{ "Published" | translate }}:</strong>
                {{ entry.published | timeago:true }}
              </p>
            </div>

            <div class="col-12 col-md-6">
              <div class="text-right form-actions mt-0">
                <button class="btn btn-secondary" (click)="viewFullscreen(entry.pk)">
                  <fa-icon icon="search-plus"></fa-icon>
                  {{ "View large" | translate }}
                </button>

                <button class="btn btn-primary"
                        *ngIf="(isSubmitted$(entry.pk) | async) === false; else retract"
                        (click)="postSubmission(entry.pk)"
                        [class.loading]="loadingService.isLoading()">
                  <fa-icon icon="star"></fa-icon>
                  {{ "Promote" | translate }}
                </button>

                <ng-template #retract>
                  <button class="btn btn-danger"
                          (click)="deleteSubmission(entry.pk)"
                          [class.loading]="loadingService.isLoading()">
                    <fa-icon icon="undo"></fa-icon>
                    {{ "Retract promotion" | translate }}
                  </button>
                </ng-template>


              </div>
            </div>
          </div>
        </div>

      </div>

      <ngb-pagination *ngIf="paginationService.showPagination(submissionQueue.count)" (pageChange)="pageChange($event)"
                    [(page)]="page" [collectionSize]="submissionQueue.count">
    </ngb-pagination>

    </ng-container>
  </ng-container>
</ng-container>

<ng-template #noEntries>
  <p class="page">
    {{ "The submission queue is currently empty." | translate }}&nbsp;{{ "Please come back later!" | translate }}
  </p>
</ng-template>

<ng-template #noneSpecified>
  {{ "None specified" | translate }}
</ng-template>
