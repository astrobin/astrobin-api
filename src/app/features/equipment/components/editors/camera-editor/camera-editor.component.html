<form [formGroup]="form" id="camera-editor-form">
  <formly-form [fields]="fields" [form]="form" [model]="model"></formly-form>
</form>

<ng-container *ngIf="brandCreation.inProgress">
  <div class="mt-4 mb-4 text-center">
    <fa-icon icon="arrow-down"></fa-icon>
  </div>

  <div class="card" id="create-new-brand" [class.disabled-with-backdrop]="subCreation.inProgress">
    <div class="backdrop"></div>

    <div class="card-header">
      {{ "Create new brand" | translate }}
    </div>

    <div class="card-body">
      <astrobin-brand-editor
        [form]="brandCreation.form"
        [name]="brandCreation.name"
        [model]="brandCreation.model"
        (suggestionSelected)="brandCreated($event)"
      ></astrobin-brand-editor>
    </div>

    <div class="card-footer">
      <button
        class="btn btn-sm-block btn-secondary"
        [class.loading]="loadingService.isLoading()"
        (click)="endBrandCreation()"
      >
        Cancel
      </button>

      <button
        class="btn btn-sm-block btn-primary"
        [disabled]="!brandCreation.form.valid"
        [class.loading]="loadingService.isLoading()"
        (click)="createBrand()"
      >
        Create
      </button>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="subCreation.inProgress">
  <div class="mt-4 mb-4 text-center">
    <fa-icon icon="arrow-down"></fa-icon>
  </div>

  <div class="card" id="create-new-sensor" [class.disabled-with-backdrop]="nestedSubCreation.inProgress">
    <div class="backdrop"></div>

    <div class="card-header">
      {{ "Create new sensor" | translate }}
    </div>

    <div class="card-body">
      <astrobin-sensor-editor
        [form]="subCreation.form"
        [model]="subCreation.model"
        [name]="subCreation.name"
        (subCreationInProgress)="nestedSubCreation.inProgress = $event"
        (suggestionSelected)="sensorCreated($event)"
      ></astrobin-sensor-editor>
    </div>

    <div class="card-footer">
      <button
        class="btn btn-sm-block btn-secondary"
        [class.loading]="loadingService.isLoading()"
        (click)="endSensorCreation()"
      >
        Cancel
      </button>

      <button
        class="btn btn-sm-block btn-primary"
        [disabled]="!subCreation.form.valid"
        [class.loading]="loadingService.isLoading()"
        (click)="createSensor()"
      >
        Create
      </button>
    </div>
  </div>
</ng-container>

<ng-template #brandOptionTemplate let-item="item">
  <astrobin-brand-summary [brand]="item.brand"></astrobin-brand-summary>
</ng-template>

<ng-template #sensorOptionTemplate let-item="item">
  <astrobin-equipment-item-summary [item]="item.sensor" [showSubItem]="false"></astrobin-equipment-item-summary>
</ng-template>

<ng-template #similarItemsTemplate let-items="data">
  <astrobin-similar-items-suggestion
    [items]="items"
    (itemSelected)="suggestionSelected.emit($event)"
  ></astrobin-similar-items-suggestion>
</ng-template>

<ng-template #othersInBrandTemplate let-items="data">
  <astrobin-equipment-others-in-brand [items]="items"></astrobin-equipment-others-in-brand>
</ng-template>
