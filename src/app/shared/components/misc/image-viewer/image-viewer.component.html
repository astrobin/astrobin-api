<div class="image-viewer-overlay">
  <ng-container *ngIf="!!image; else loadingTemplate">
    <ng-container [ngTemplateOutlet]="imageAreaTemplate"></ng-container>

    <div class="data-area-container">
      <ng-container [ngTemplateOutlet]="dataAreaTemplate"></ng-container>
      <ng-container [ngTemplateOutlet]="buttonsAreaTemplate"></ng-container>
    </div> <!-- data-area-container -->
  </ng-container>
</div>

<ng-template #loadingTemplate>
  <astrobin-loading-indicator></astrobin-loading-indicator>
</ng-template>

<ng-template #imageAreaTemplate>
  <div class="image-area">
    <button class="close-button" (click)="close()">
      <fa-icon icon="times-circle"></fa-icon>
    </button>

    <button *ngIf="!image.videoFile" class="fullscreen-button" (click)="openFullscreen($event)">
      <fa-icon icon="expand"></fa-icon>
    </button>

    <button
      *ngIf="currentIndex > 0"
      (click)="onPreviousClicked()"
      class="previous-button"
    >
      <fa-icon icon="chevron-circle-left"></fa-icon>
    </button>

    <astrobin-fullscreen-image-viewer
      [id]="image.pk"
    ></astrobin-fullscreen-image-viewer>

    <astrobin-image
      [alias]="alias"
      [image]="image"
    ></astrobin-image>

    <button
      *ngIf="currentIndex < navigationContext?.length - 1"
      (click)="onNextClicked()"
      class="next-button"
    >
      <fa-icon icon="chevron-circle-right"></fa-icon>
    </button>
  </div>
</ng-template>

<ng-template #equipmentTemplate>
  <div *ngIf="equipmentItems?.length > 0" class="equipment data-area-section">
    <a
      *ngFor="let item of equipmentItems"
      href="#"
      (click)="equipmentItemClicked($event, item)"
      class="value"
    >
      <astrobin-equipment-item-display-name
        [item]="item"
        [enableKlassIcon]="true"
        [enableBrandLink]="false"
        [enableNameLink]="false"
        [enableSummaryModal]="false"
        [showFrozenAsAmbiguous]="false"
        [showItemUnapprovedInfo]="false"
      ></astrobin-equipment-item-display-name>
    </a>
  </div>
</ng-template>

<ng-template #descriptionTemplate>
  <div *ngIf="image.descriptionBbcode" class="description data-area-section">
    <div class="value" [innerHTML]="image.descriptionBbcode | BBCodeToHtml"></div>
  </div>

  <div *ngIf="image.description && !image.descriptionBbcode" class="description data-area-section">
    <div class="value" [innerHTML]="image.description"></div>
  </div>
</ng-template>

<ng-template #dataAreaTemplate>
  <div class="data-area">
    <astrobin-image-viewer-title [image]="image"></astrobin-image-viewer-title>

    <astrobin-image-viewer-photographers [image]="image"></astrobin-image-viewer-photographers>

    <astrobin-image-viewer-data-source [image]="image"></astrobin-image-viewer-data-source>

    <astrobin-image-viewer-acquisition
      *ngIf="image.deepSkyAcquisitions?.length || image.solarSystemAcquisitions?.length"
      [image]="image"
    ></astrobin-image-viewer-acquisition>

    <astrobin-image-viewer-astrometry
      *ngIf="image.solution"
      [image]="image"
    ></astrobin-image-viewer-astrometry>

    <ng-container [ngTemplateOutlet]="equipmentTemplate"></ng-container>
    <ng-container [ngTemplateOutlet]="descriptionTemplate"></ng-container>
  </div> <!-- data-area -->
</ng-template>

<ng-template #buttonsAreaTemplate>
  <div class="buttons-area">
    <ng-container *ngIf="currentUserWrapper$ | async as currentUserWrapper">
      <div *ngIf="currentUserWrapper.user?.id !== image.user" class="like">
        <astrobin-toggle-property
          [contentType]="imageContentType.id"
          [objectId]="image.pk"
          [userId]="currentUserWrapper.user?.id"
          [showLabel]="false"
          btnClass="btn btn-link link-secondary"
          propertyType="like"
        ></astrobin-toggle-property>
        <span class="count">{{ image.likeCount }}</span>
      </div>

      <div class="bookmark">
        <astrobin-toggle-property
          [contentType]="imageContentType.id"
          [objectId]="image.pk"
          [userId]="currentUserWrapper.user?.id"
          [showLabel]="false"
          btnClass="btn btn-link link-secondary"
          propertyType="bookmark"
        ></astrobin-toggle-property>
        <span class="count">{{ image.bookmarkCount }}</span>
      </div>

      <div *ngIf="currentUserWrapper.user?.id !== image.user" class="follow">
        <astrobin-toggle-property
          [contentType]="userContentType.id"
          [objectId]="image.user"
          [userId]="currentUserWrapper.user?.id"
          [showLabel]="false"
          [setLabel]="'Follow user' | translate"
          [unsetLabel]="'Unfollow user' | translate"
          btnClass="btn btn-link link-secondary"
          propertyType="follow"
        ></astrobin-toggle-property>
        <span class="count">{{ image.userFollowerCount }}</span>
      </div>
      <div class="comment">
        <button
          (click)="openCommentsModal($event)"
          class="btn btn-link link-secondary"
        >
          <fa-icon icon="comments"></fa-icon>
        </button>
        <span class="count">
              <astrobin-nested-comments-count
                [contentType]="imageContentType"
                [objectId]="image.pk"
              ></astrobin-nested-comments-count>
            </span>
      </div>
    </ng-container>
  </div> <!-- buttons-area -->
</ng-template>
