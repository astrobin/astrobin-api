<ng-container *ngIf="!!image && !!thumbnailUrl; else loadingTemplate">
  <ng-container *ngIf="!!image.videoFile; else imageTemplate">
    <ng-container *ngIf="videoJsReady; else simpleLoadingTemplate">
      <ng-container *ngIf="!!image.encodedVideoFile; else stillProcessingTemplate">
        <video
          #videoPlayerElement
          [attr.data-setup]='videoSetup'
          [attr.poster]="thumbnailUrl"
          class="video-js vjs-default-skin"
          controls
          preload="auto"
        >
          <source src="{{ image.encodedVideoFile }}" type="video/mp4" />
        </video>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>

<ng-template #imageTemplate>
  <img
    (load)="onLoad($event)"
    (click)="onClick($event)"
    (mouseenter)="imageMouseEnter.emit($event)"
    (mouseleave)="imageMouseLeave.emit($event)"
    [alt]="image.title"
    [src]="thumbnailUrl"
    class="astrobin-image"
    id="image-{{ id }}{{ image.hash ? '-' + image.hash : '' }}-{{ revision }}-{{ alias }}"
  >
</ng-template>

<ng-template #loadingTemplate>
  <div
    [style.height]="!!height ? height + 'px' : 'auto'"
    [style.padding]="!!height ? 0 : '2rem'"
    class="loading-container"
  >
    <astrobin-loading-indicator [progress]="progress"></astrobin-loading-indicator>
  </div>
</ng-template>

<ng-template #simpleLoadingTemplate>
  <div
    [style.height]="!!height ? height + 'px' : 'auto'"
    [style.padding]="!!height ? 0 : '2rem'"
    class="loading-container"
  >
    <astrobin-loading-indicator></astrobin-loading-indicator>
  </div>
</ng-template>

<ng-template #stillProcessingTemplate>
  <p class="alert alert-info video-still-processing" translate>
    This video is still processing, please return to this page later.
  </p>
</ng-template>
